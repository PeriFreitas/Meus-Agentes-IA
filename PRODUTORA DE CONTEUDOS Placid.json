{
  "name": "PRODUTORA DE CONTEUDOS Placid",
  "nodes": [
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "gpt-5-mini",
          "mode": "list",
          "cachedResultName": "GPT-5-MINI"
        },
        "messages": {
          "values": [
            {
              "content": "Voc√™ √© um especialista em marketing para energia solar. Crie posts engajadores para Instagram/TikTok da Uzzi Energia Solar. Use linguagem acess√≠vel, foque em economia, sustentabilidade e benef√≠cios. Inclua sempre um call-to-action. M√°ximo 100 palavras.",
              "role": "system"
            },
            {
              "content": "=Crie um post sobre um dos temas: economia na conta de luz, sustentabilidade, tecnologia solar, case de sucesso, dicas de consumo consciente, benef√≠cios da energia solar, futuro da energia renov√°vel. Seja criativo e engajador."
            }
          ]
        },
        "options": {}
      },
      "id": "97a9a652-6158-40b0-983a-a7d7ac488644",
      "name": "OpenAI - Gerar Conte√∫do",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1,
      "position": [
        -1520,
        32
      ],
      "credentials": {
        "openAiApi": {
          "id": "c9iAooAo5TXPfWFM",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// C√≥digo completamente seguro - sem acessos diretos a propriedades\nconst items = $input.all();\n\n// Verificar se temos dados\nif (!items || items.length === 0) {\n    return {\n        \"texto_formatado\": \"Nenhum dado de entrada\",\n        \"timestamp\": new Date().toISOString().slice(0, -5),\n        \"texto_completo\": \"Nenhum dado de entrada\",\n        \"debug\": \"Sem itens de entrada\"\n    };\n}\n\nconst firstItem = items[0];\nlet content = \"\";\n\n// Tentar diferentes formas de extrair o texto\nif (firstItem.json) {\n    // Converter todo o JSON para string primeiro\n    const jsonStr = JSON.stringify(firstItem.json, null, 2);\n    \n    // Procurar por padr√µes de texto longo no JSON\n    const jsonObj = firstItem.json;\n    \n    // Lista de poss√≠veis chaves onde pode estar o conte√∫do\n    const possibleKeys = ['conteudo', 'content', 'texto', 'text', 'message', 'body', 'description'];\n    \n    // Fun√ß√£o recursiva para procurar conte√∫do\n    function findContent(obj, path = '') {\n        if (typeof obj === 'string' && obj.length > 20) {\n            return { content: obj, path: path };\n        }\n        \n        if (typeof obj === 'object' && obj !== null) {\n            for (const [key, value] of Object.entries(obj)) {\n                const result = findContent(value, path ? `${path}.${key}` : key);\n                if (result) return result;\n            }\n        }\n        \n        return null;\n    }\n    \n    const found = findContent(jsonObj);\n    \n    if (found) {\n        content = found.content;\n    } else {\n        // Se n√£o encontrou, usar uma string do JSON como fallback\n        content = jsonStr.substring(0, 200);\n    }\n} else if (typeof firstItem === 'string') {\n    content = firstItem;\n} else {\n    content = JSON.stringify(firstItem).substring(0, 200);\n}\n\n// Garantir que temos uma string v√°lida\nif (!content || typeof content !== 'string') {\n    content = \"Conte√∫do n√£o identificado\";\n}\n\n// Limpar o texto\nconst cleanText = content\n    .replace(/[{}\"\\\\]/g, ' ')  // Remove caracteres JSON\n    .replace(/\\n+/g, ' ')      // Remove quebras de linha\n    .replace(/\\s+/g, ' ')      // Remove espa√ßos extras\n    .trim();                   // Remove espa√ßos nas bordas\n\n// Vers√£o curta\nconst shortText = cleanText.length > 80 ? \n    cleanText.substring(0, 77) + '...' : cleanText;\n\n// Timestamp\nconst timestamp = new Date().toISOString().slice(0, -5);\n\nreturn {\n    \"texto_formatado\": shortText,\n    \"timestamp\": timestamp,\n    \"texto_completo\": cleanText\n};"
      },
      "id": "fa7bed86-cec7-46d4-9651-d7cd6ec6165f",
      "name": "Formatar Texto",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1232,
        32
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.placid.app/api/rest/uvmtzyznu7mgt",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "specifyHeaders": "json",
        "jsonHeaders": "={\n  \"create_now\": true,\n  \"layers\": {\n    \"text_layer\": \"{{ $json.post_text }}\",\n    \"logo_layer\": \"Uzzi Energia Solar\"\n  },\n  \"format\": \"jpg\",\n  \"width\": 1080,\n  \"height\": 1080\n}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "be678a32-d6b2-4f51-bda7-2ef1604093dc",
      "name": "Placid - Gerar Imagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        -1056,
        32
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "CkARZoK9TCM5wJf2",
          "name": "Header Auth account 4"
        }
      }
    },
    {
      "parameters": {
        "tableId": "uzzi_social_posts",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "full_text",
              "fieldValue": "={{ $('Formatar Texto').item.json.texto_completo }}\n\n"
            },
            {
              "fieldId": "post_text",
              "fieldValue": "={{ $json.id }}"
            },
            {
              "fieldId": "filename",
              "fieldValue": "=imagem_{{ $json.id }}.jpg"
            },
            {
              "fieldId": "image_url",
              "fieldValue": "={{ $json.polling_url }}"
            }
          ]
        }
      },
      "id": "275477fc-1109-4a3c-842e-29ff88f7a78e",
      "name": "Supabase - Salvar Post",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -848,
        32
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5K8QedveA5xu99g3",
          "name": "supabase bravaIA"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "error-condition",
              "leftValue": "{{ $json.error }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "94e722d3-d376-4d7a-9d0a-76f6721f5940",
      "name": "Error Handler",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -832,
        256
      ]
    },
    {
      "parameters": {
        "tableId": "uzzi_workflow_logs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "error_details",
              "fieldValue": "={{$json}}"
            },
            {
              "fieldId": "node_name",
              "fieldValue": "Placid - Gerar Imagem"
            }
          ]
        }
      },
      "id": "46d2ae07-15e1-4466-9979-26cc2b63950d",
      "name": "Supabase - Log Error",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -608,
        240
      ],
      "credentials": {
        "supabaseApi": {
          "id": "5K8QedveA5xu99g3",
          "name": "supabase bravaIA"
        }
      }
    },
    {
      "parameters": {
        "chatId": "1060369567",
        "text": "=üöÄ Novo post criado automaticamente!\n\nüìù Conte√∫do: Teste envio do bot üöÄ\n\n\nüñºÔ∏è Imagem ID: {{ $('Placid - Gerar Imagem').item.json.id }}\n\nüíæ Salvo no Supabase: {{ $('Supabase - Salvar Post').item.json.id }}\n\n‚è∞ Status: Rascunho criado em {{ $('Supabase - Salvar Post').item.json.created_at }}\n\nüéØ Pronto para revis√£o e publica√ß√£o!",
        "additionalFields": {}
      },
      "id": "d70844fc-eaa7-4d2e-a3e7-359c1a38c18b",
      "name": "Telegram - Notifica√ß√£o",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -640,
        32
      ],
      "webhookId": "e1d21eaf-3c03-4cab-ad78-f815d5371f5c",
      "credentials": {
        "telegramApi": {
          "id": "Z8fAnhssYsmy3Xet",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1680,
        32
      ],
      "id": "d7347f04-c0a8-499b-a90a-44e35ad458a3",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    }
  ],
  "pinData": {
    "OpenAI - Gerar Conte√∫do": [
      {
        "json": {
          "index": 0,
          "message": {
            "role": "assistant",
            "content": "Quer reduzir sua conta de luz em at√© 95%? ‚òÄÔ∏è Com a Uzzi Energia Solar voc√™ transforma o telhado em economia: menos gastos, previsibilidade e valoriza√ß√£o do im√≥vel. Al√©m de poupar, voc√™ ajuda o planeta! üå± Fa√ßa uma simula√ß√£o gr√°tis e descubra seu plano ideal. Comente \"QUERO\" ou clique no link na bio ‚Äî vamos calcular sua economia hoje mesmo!",
            "refusal": null,
            "annotations": []
          },
          "finish_reason": "stop"
        }
      }
    ]
  },
  "connections": {
    "OpenAI - Gerar Conte√∫do": {
      "main": [
        [
          {
            "node": "Formatar Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Formatar Texto": {
      "main": [
        [
          {
            "node": "Placid - Gerar Imagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Placid - Gerar Imagem": {
      "main": [
        [
          {
            "node": "Supabase - Salvar Post",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - Salvar Post": {
      "main": [
        [
          {
            "node": "Telegram - Notifica√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler": {
      "main": [
        [
          {
            "node": "Supabase - Log Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "OpenAI - Gerar Conte√∫do",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4eb1d3cc-9913-44ec-bb6e-670c49c95ed2",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "b1646430cd996814a4d81c1dfc7a9b1eaf95135bc455fab10103bd949f30c6d7"
  },
  "id": "mE3Ea1HHQEZVe8kW",
  "tags": []
}